(()=>{"use strict";var t={390:(t,e)=>{var r,s=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var s in e=arguments[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},n=function(t,e){if(t){"undefined"!=typeof window&&function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),r}"function"!=typeof window.CustomEvent&&(t.prototype=window.Event.prototype,window.CustomEvent=t)}(),e||(e={}),e=s({},{minHorizontal:10,minVertical:10,deltaHorizontal:3,deltaVertical:5,preventScroll:!1,lockAxis:!0,touch:!0,mouse:!0},e);var r=[],n=!1,i=function(){n=!0},o=function(t){n=!1,l(t)},a=function(t){n&&(t.changedTouches=[{clientX:t.clientX,clientY:t.clientY}],c(t))};e.mouse&&(t.addEventListener("mousedown",i),t.addEventListener("mouseup",o),t.addEventListener("mousemove",a));var l=function(n){var i=Math.abs,o=Math.max,a=Math.min;if(r.length){for(var l="function"==typeof TouchEvent&&n instanceof TouchEvent,c=[],u=[],h={top:!1,right:!1,bottom:!1,left:!1},d=0;d<r.length;d++)c.push(r[d].x),u.push(r[d].y);var p=c[0],m=c[c.length-1],g=u[0],v=u[u.length-1],b={x:[p,m],y:[g,v]};if(1<r.length){var S={detail:s({touch:l,target:n.target},b)},f=new CustomEvent("swiperelease",S);t.dispatchEvent(f)}var y=c[0]-c[c.length-1],w="none";w=0<y?"left":"right";var A=a.apply(Math,c),q=o.apply(Math,c);if(i(y)>=e.minHorizontal&&("left"==w?i(A-c[c.length-1])<=e.deltaHorizontal&&(h.left=!0):"right"==w&&i(q-c[c.length-1])<=e.deltaHorizontal&&(h.right=!0)),w="none",w=0<(y=u[0]-u[u.length-1])?"top":"bottom",A=a.apply(Math,u),q=o.apply(Math,u),i(y)>=e.minVertical&&("top"==w?i(A-u[u.length-1])<=e.deltaVertical&&(h.top=!0):"bottom"==w&&i(q-u[u.length-1])<=e.deltaVertical&&(h.bottom=!0)),r=[],h.top||h.right||h.bottom||h.left){e.lockAxis&&((h.left||h.right)&&i(p-m)>i(g-v)?h.top=h.bottom=!1:(h.top||h.bottom)&&i(p-m)<i(g-v)&&(h.left=h.right=!1));var L={detail:s({directions:h,touch:l,target:n.target},b)},I=new CustomEvent("swipe",L);t.dispatchEvent(I)}else{var E=new CustomEvent("swipecancel",{detail:s({touch:l,target:n.target},b)});t.dispatchEvent(E)}}},c=function(s){var n=s.changedTouches[0];if(r.push({x:n.clientX,y:n.clientY}),1<r.length){var i={detail:{x:[r[0].x,r[r.length-1].x],y:[r[0].y,r[r.length-1].y],touch:"function"==typeof TouchEvent&&s instanceof TouchEvent,target:s.target}},o=new CustomEvent("swiping",i);(!0===e.preventScroll||"function"==typeof e.preventScroll&&e.preventScroll(o))&&s.preventDefault(),t.dispatchEvent(o)}},u=!1;try{var h=Object.defineProperty({},"passive",{get:function(){u={passive:!e.preventScroll}}});window.addEventListener("testPassive",null,h),window.removeEventListener("testPassive",null,h)}catch(t){}return e.touch&&(t.addEventListener("touchmove",c,u),t.addEventListener("touchend",l)),{off:function(){t.removeEventListener("touchmove",c,u),t.removeEventListener("touchend",l),t.removeEventListener("mousedown",i),t.removeEventListener("mouseup",o),t.removeEventListener("mousemove",a)}}}};void 0!==t.exports?(t.exports=n,t.exports.default=n):void 0===(r=function(){return n}.apply(e,[]))||(t.exports=r)}},e={};function r(s){var n=e[s];if(void 0!==n)return n.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t=r(390),e=r.n(t);const s="?debug"===window.location.search;(()=>{const t=document.querySelector(".toggle-burger-menu");t.addEventListener("click",(()=>{"true"===t.getAttribute("aria-expanded")?(t.setAttribute("aria-expanded","false"),document.body.classList.remove("open-menu")):(t.setAttribute("aria-expanded","true"),document.body.classList.add("open-menu"))}))})(),(()=>{Array.prototype.slice.call(document.querySelectorAll(".share-link")).map((t=>{t.setAttribute("href",`${t.getAttribute("href")}${encodeURIComponent(window.location.href)}`)}));const t=document.querySelector(".share").cloneNode(!0);document.querySelector(".menu-content").prepend(t)})(),new class{stepId="0";offset=0;transitionInProgress=!1;transitionDuration=1500;main=document.querySelector("main");steps=document.querySelector(".steps");currentStep=document.querySelector(`#step-${this.stepId}`);tree=[];stepsId=["0"];parcoursId=1;constructor(){setTimeout((()=>{this.showCurrentStep()}),50),this.listenKeyboard(),this.listenMouseWheel(),this.listenSwipe(),window.addEventListener("resize",this.onResize.bind(this)),this.onResize(),this.loadTree(),document.querySelector(".debug-go").addEventListener("click",(()=>{this.navigateToStep(document.querySelector(".debug-step").value)}))}loadTree(){fetch("json/tree.json?v1.2").then((t=>{t.json().then((t=>{this.tree=t.tree,this.initCurrentStep()}))}))}listenKeyboard(){document.addEventListener("keyup",(t=>{switch(t.key){case"ArrowDown":case"ArrowRight":this.navigateToNextStep("Keyboard");break;case"ArrowUp":case"ArrowLeft":this.navigateToPreviousStep("Keyboard")}}))}listenMouseWheel(){window.addEventListener("wheel",(t=>{const e=Math.sign(t.deltaY);e>0&&this.navigateToNextStep("Wheel"),e<0&&this.navigateToPreviousStep("Wheel")}))}listenSwipe(){e()(this.main),this.main.addEventListener("swipe",(t=>{t.detail.directions.top&&this.navigateToNextStep("Swipe"),t.detail.directions.bottom&&this.navigateToPreviousStep("Swipe")}))}addInsecableSpaces(t){const e="&nbsp;";return t.replaceAll(" + ",`${e}+${e}`).replaceAll(" ?",`${e}?`).replaceAll(" !",`${e}!`).replaceAll(" :",`${e}:`)}constructStepIntermediate(t){const e=document.querySelector(".step-intermediate-tpl"),r=document.importNode(e.content,!0).querySelector("section");r.setAttribute("data-from-path",t);const s=`intermediate-${this.stepsId.length}`;r.setAttribute("id",s),this.currentStep.after(r),this.stepsId.push(s)}getLabelLength(t){return Math.min(Math.round(t.length/20),3)}constructStep(t){t.paths||(t.paths=[]);const e=document.querySelector(".step-tpl"),r=document.importNode(e.content,!0),s=r.querySelector("section"),n=s.querySelector("article"),i=r.querySelector(".zone-left"),o=r.querySelector(".zone-right"),a=r.querySelector(".button-center"),l=r.querySelector(".button-left"),c=r.querySelector(".button-right"),u=r.querySelector(".button-arrow");if(s.setAttribute("id",`step-${t.id}`),s.setAttribute("data-path",t.paths.length),r.querySelector("h2").innerHTML=this.addInsecableSpaces(t.title||""),t.title.length<40&&r.querySelector("h2").classList.add("short-title"),t.image){const e=document.createElement("img");e.src=t.image,r.querySelector("h2").after(e),n.classList.add("has-image")}if(t.video){const e=document.createElement("iframe");e.src=`./video/${t.video}.html`,e.setAttribute("data-src",e.src),e.setAttribute("frameborder",0),e.setAttribute("allowfullscreen",!0),r.querySelector("h2").after(e),n.classList.add("has-video"),n.classList.add(`video-${t.video}`)}0===t.paths.length&&a.remove(),t.paths.length<=1&&(r.querySelector(".path-left").remove(),r.querySelector(".path-right").remove(),i.remove(),o.remove()),1===t.paths.length?t.paths[0].label?(a.setAttribute("data-target",t.paths[0].step),a.innerHTML=this.addInsecableSpaces(t.paths[0].label),a.setAttribute("data-label-length",this.getLabelLength(t.paths[0].label)),u.remove()):(a.remove(),u.setAttribute("data-target",t.paths[0].step)):u.remove();const h=2===t.paths.length?1:2;if(t.paths.length>=2&&(l.innerHTML=this.addInsecableSpaces(t.paths[0].label),l.setAttribute("data-target",t.paths[0].step),l.setAttribute("data-label-length",this.getLabelLength(t.paths[0].label)),c.innerHTML=this.addInsecableSpaces(t.paths[h].label),c.setAttribute("data-target",t.paths[h].step),c.setAttribute("data-label-length",this.getLabelLength(t.paths[h].label))),2===t.paths.length&&(a.remove(),l.setAttribute("data-from-path","2a"),c.setAttribute("data-from-path","2b")),3===t.paths.length){const e=1;a.innerHTML=this.addInsecableSpaces(t.paths[e].label),a.setAttribute("data-target",t.paths[e].step),a.setAttribute("data-label-length",Math.round(t.paths[e].label.length/50)),l.setAttribute("data-from-path","3a"),a.setAttribute("data-from-path","3b"),c.setAttribute("data-from-path","3c")}document.querySelector(".steps").appendChild(r)}initCurrentStep(){Array.prototype.slice.call(this.currentStep.getElementsByTagName("button")).map((t=>{t.addEventListener("click",(()=>{const e=t.getAttribute("data-target"),r=t.getAttribute("data-from-path");r&&this.constructStepIntermediate(r),this.currentStep.querySelector("iframe")&&this.currentStep.querySelector("iframe").setAttribute("src",""),this.navigateToStep(e)}))}))}hideCurrentStep(){this.currentStep.classList.remove("show")}showCurrentStep(){this.currentStep.classList.add("show"),this.currentStep.querySelector("iframe")&&this.currentStep.querySelector("iframe").setAttribute("src",this.currentStep.querySelector("iframe").getAttribute("data-src"))}navigateToNextStep(){this.transitionInProgress||1===this.currentStep.getElementsByTagName("button").length&&this.currentStep.getElementsByTagName("button")[0].click()}getStepIdBySection(t){return t.getAttribute("id").split("step-")[1]}navigateToPreviousStep(){if(this.transitionInProgress)return;const t=this.stepsId.indexOf(this.stepId);if(t>0){let e=this.steps.querySelectorAll("section")[t-1];e.getAttribute("data-from-path")&&(e=this.steps.querySelectorAll("section")[t-2]),this.navigateToStep(this.getStepIdBySection(e))}}getStepById(t){return this.tree.find((e=>String(e.id)===t))}getParcoursByStepId(t){return Math.ceil((Number(t)+1)/100)}navigateToStep(t){if(this.transitionInProgress)return;document.querySelector(".debug-step").value=t;let e=!1;if(!document.querySelector(`#step-${t}`)){const r=this.getStepById(t);if(!r)return void console.error("step not found id:",t);this.constructStep(r),e=!0,this.stepsId.push(t)}switch(this.transitionInProgress=!0,this.steps.classList.add("hasTransition"),setTimeout((()=>{this.transitionInProgress=!1,this.steps.classList.remove("hasTransition");const t=[];this.stepsId.map((e=>(this.stepsId.indexOf(e)>this.stepsId.indexOf(this.stepId)?document.querySelector(`#step-${e}`)?document.querySelector(`#step-${e}`).remove():document.querySelector(`#${e}`)&&document.querySelector(`#${e}`).remove():t.push(e),e))),this.stepsId=t}),this.transitionDuration),this.hideCurrentStep(),this.stepId=t,this.currentStep=document.querySelector(`#step-${this.stepId}`),this.offset=this.stepsId.indexOf(t),this.steps.setAttribute("style",`transform:translateY(-${this.offset*window.innerHeight}px)`),e&&(this.initCurrentStep(),this.onResize()),setTimeout((()=>{this.showCurrentStep()}),this.transitionDuration/3),this.parcoursId=this.getParcoursByStepId(this.stepId),this.parcoursId){case 1:utag_data.thematique="rÃ©seaux";break;case 2:utag_data.thematique="eco-gestes";break;case 3:utag_data.thematique="start-up"}this.stepData=this.getStepById(this.stepId)}onResize(){this.main.setAttribute("style",`height:${window.innerHeight}px`),Array.prototype.slice.call(this.steps.querySelectorAll("section")).map((t=>t.setAttribute("style",`height:${window.innerHeight}px`))),this.steps.setAttribute("style",`transform:translateY(-${this.offset*window.innerHeight}px)`)}},s&&document.querySelector(".debug").classList.add("show")})()})();